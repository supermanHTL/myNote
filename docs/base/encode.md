# 编码

#### ASCII 编码

我们知道，计算机内部，所有信息最终都是一个二进制值。每一个二进制位（`bit`）有`0`和`1`两种状态，因此八个二进制位就可以组合出`256`种状态，这被称为一个字节（`byte`）。也就是说，`一个字节`一共可以用来表示`256`种不同的状态，每一个状态对应一个符号，就是`256`个符号，从`00000000`到`11111111`。
上个世纪 60 年代，美国制定了一套字符编码，对英语字符与二进制位之间的关系，做了统一规定。这被称为 `ASCII`码，一直沿用至今。

`ASCII`码一共规定了`128`个字符的编码，比如空格`SPACE`是`32`（二进制`00100000`），大写的字母`A`是`65`（二进制`01000001`）。这`128`个符号（包括`32`个不能打印出来的控制符号），只占用了一个字节的后面`7`位，最前面的一位统一规定为`0`

#### ASCII、Unicode、UTF-8 关系

1.  `ASCII` 码 也是一种**字符集**
    **缺点**：只有字母、数字和个别符号，计算机推广全世界时，不满足不同国家的语言

2.  `Unicode`：中文又称万国码、国际码、统一码、单一码。通常会用“U+”然后紧接着一组十六进制的数字来表示这一个字符，即是一种 **字符集**。
    英语用`128（0--127）`个符号编码就够了，但是用来表示其他语言，`128个`符号是不够的。因此不同国家开始从`128--255`这一段开始五花八门的定义各自的语言字符。导致同一个二进制数字可以被解释成不同的符号，就出现了乱码。可以想象，如果有一种编码，将世界上所有的符号都纳入其中。每一个符号都给予一个独一无二的编码，那么乱码问题就会消失。这就是 `Unicode`，就像它的名字都表示的，这是一种所有符号的编码。

        **注意**：`Unicode`只是一个符号集合。它只是规定了符号的二进制代码，却没有规定这个二进制代码应该如何存储。（*`unicode`集合就类似一本字典，里面记录了每个元素对应的二进制是长什么样子。但是计算机在读写的时候，却不知道是几个字节为一个元素*）

3.  `UTF-8`：在互联网上使用最广的一种 Unicode 的实现方式。最大的一个特点，就是它是一种变长的编码方式。它可以使用`1~4个`字节表示一个符号，根据不同的符号而变化字节长度（`UTF-8`也就是`unicode`在计算机一种存储方式），即：是一种**字符编码**。

    **UTF-8 的编码规则很简单，只有二条** ：

    - 对于单字节的符号，字节的第一位设为`0`，后面 7 位为这个符号的`Unicode` 码( 转二进制的码 )。因此对于英语字母，`UTF-8`编码和 `ASCII` 码是相同的。
    - 对于`n`字节的符号（`n > 1`），第一个字节的前`n`位都设为`1`，第`n + 1`位设为`0`，后面字节的前两位一律设为`10`。剩下的没有提及的二进制位，全部为这个符号的 `Unicode` 码

      | Unicode 符号范围 （十六进制） | UTF-8 编码方式（二进制）            | 通过 charCodeAt()返回十进制的 Unicode |
      | ----------------------------- | ----------------------------------- | ------------------------------------- |
      | 0000 0000-0000 007F           | 0xxxxxxx                            | 0 - 127                               |
      | 0000 0080-0000 07FF           | 110xxxxx 10xxxxxx                   | 128 - 2047                            |
      | 0000 0800-0000 FFFF           | 1110xxxx 10xxxxxx 10xxxxxx          | 2048 - 65535                          |
      | 0001 0000-0010 FFFF           | 11110xxx 10xxxxxx 10xxxxxx 10xxxxxx | 65536 - 2097151                       |


        跟据上表，解读 `UTF-8 `编码非常简单。如果一个字节的第一位是`0`，则这个字节单独就是一个字符；如果第一位是`1`，则连续有多少个`1`，就表示当前字符占用多少个字节。

> 细节查看阮一峰文章：[http://www.ruanyifeng.com/blog/2007/10/ascii_unicode_and_utf-8.html](http://www.ruanyifeng.com/blog/2007/10/ascii_unicode_and_utf-8.html)
>
> Unicode 和 Utf-8 字符编码字节 转换参考文章：[https://blog.csdn.net/weixin_41134409/article/details/109159469](https://blog.csdn.net/weixin_41134409/article/details/109159469)

**pis：** 编码这块结合*字符串的`charCodeAt()` 和`String.fromCharCode()`学习*

#### 文本解析器 TextDecoder

`TextDecoder` 接口表示一个文本解码器，一个解码器只支持一种特定文本编码，例如  `utf-8`、`iso-8859-2`、`koi8`、`cp1261`，`gbk`  等等。解码器将字节流作为输入，并提供代码点流作为输出。

```
const arr =  ["0xE6", "0xB5", "0x8B", "0xE8", "0xAF", "0x95"];  // 字符串 "测试”的utf-8字符编码字节
const utf8decoder = new TextDecoder('utf-8'); // 默认 'utf-8' or 'utf8'
const u8arr = new Uint8Array(arr);
utf8decoder.decode(u8arr); // "测试"
```
